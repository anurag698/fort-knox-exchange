
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account on the Fort Knox Exchange.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user. (Primary Key)"
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "User's chosen username."
        },
        "kycStatus": {
          "type": "string",
          "description": "KYC (Know Your Customer) status of the user (e.g., PENDING, VERIFIED, REJECTED)."
        },
        "role": {
          "type": "string",
          "description": "User role (e.g., USER, ADMIN)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the user account was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Token": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Token",
      "type": "object",
      "description": "Represents a tradable token (e.g., ETH, USDT).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Symbol of the token (e.g., BTC, ETH, USDT). Primary Key."
        },
        "name": {
          "type": "string",
          "description": "Full name of the token (e.g., Ethereum, Tether)."
        },
        "chainId": {
          "type": "number",
          "description": "The blockchain ID where this token exists."
        },
        "contractAddress": {
          "type": "string",
          "description": "The token's contract address."
        },
        "decimals": {
          "type": "number",
          "description": "The number of decimals for the token."
        },
        "isActive": {
          "type": "boolean",
          "description": "Whether the token is active for trading."
        }
      },
      "required": [
        "id",
        "name",
        "chainId",
        "contractAddress",
        "decimals"
      ]
    },
    "Market": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Market",
      "type": "object",
      "description": "Represents a trading market (e.g., BTC-USDT).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the market (e.g., BTC-USDT). Primary Key."
        },
        "baseAsset": {
          "type": "string",
          "description": "Reference to Token (base asset)."
        },
        "quoteAsset": {
          "type": "string",
          "description": "Reference to Token (quote asset)."
        },
        "pricePrecision": {
          "type": "number",
          "description": "Precision of the price for this market."
        },
        "quantityPrecision": {
          "type": "number",
          "description": "Precision of the quantity for this market."
        },
        "minOrderSize": {
          "type": "number",
          "description": "Minimum order size allowed for this market."
        },
        "isActive": {
          "type": "boolean",
          "description": "Whether the market is active."
        }
      },
      "required": [
        "id",
        "baseAsset",
        "quoteAsset"
      ]
    },
    "Balance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Balance",
      "type": "object",
      "description": "Represents a user's balance for a specific token.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Composite key: {userId}_{tokenId}"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User."
        },
        "tokenId": {
          "type": "string",
          "description": "Reference to Token."
        },
        "available": {
          "type": "string",
          "description": "Available balance of the token as a string to avoid precision issues."
        },
        "locked": {
          "type": "string",
          "description": "Locked balance of the token (used for open orders), as a string."
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the balance record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "tokenId",
        "available",
        "locked"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a user's order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User."
        },
        "mode": {
          "type": "string",
          "description": "CUSTODIAL or NON_CUSTODIAL"
        },
        "srcTokenId": {
          "type": "string",
          "description": "The token being sold."
        },
        "dstTokenId": {
          "type": "string",
          "description": "The token being bought."
        },
        "amount": {
          "type": "string",
          "description": "The amount of the source token to sell."
        },
        "amountWei": {
          "type": "string",
          "description": "The amount in the smallest unit (wei)."
        },
        "slippagePct": {
          "type": "number",
          "description": "The allowed slippage percentage."
        },
        "status": {
          "type": "string",
          "description": "Status of the order (e.g., PENDING, EXECUTING, FILLED, FAILED, CANCELED)."
        },
        "meta": {
          "type": "object",
          "description": "Any additional metadata."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "mode",
        "srcTokenId",
        "dstTokenId",
        "amount",
        "status"
      ]
    },
    "Trade": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Trade",
      "type": "object",
      "description": "Represents a single executed trade as part of an order.",
      "properties": {
        "id": {
          "type": "string"
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order."
        },
        "price": {
          "type": "number",
          "description": "Price at which the trade occurred."
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the asset traded."
        },
        "fee": {
          "type": "number",
          "description": "The fee paid for the trade."
        },
        "executedAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "orderId",
        "price",
        "quantity"
      ]
    },
    "LedgerEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LedgerEntry",
      "type": "object",
      "description": "Represents a ledger entry for a balance transaction.",
      "properties": {
        "id": {
          "type": "string"
        },
        "userId": {
          "type": "string"
        },
        "tokenId": {
          "type": "string"
        },
        "change": {
          "type": "string",
          "description": "Amount change (+ or -), as a string."
        },
        "before": {
          "type": "string"
        },
        "after": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "description": "e.g., DEPOSIT, WITHDRAWAL, TRADE_FEE, TRADE_SETTLEMENT."
        },
        "reason": {
          "type": "string"
        },
        "referenceId": {
          "type": "string",
          "description": "Reference to order, trade, or withdrawal ID."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "tokenId",
        "change",
        "type"
      ]
    },
    "DexTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DexTransaction",
      "type": "object",
      "description": "Represents a decentralized exchange transaction to be executed.",
      "properties": {
        "id": {
          "type": "string"
        },
        "orderId": {
          "type": "string"
        },
        "chainId": {
          "type": "number"
        },
        "oneinchPayload": {
          "type": "object",
          "description": "The full payload from the 1inch /swap endpoint."
        },
        "txTo": {
          "type": "string"
        },
        "txData": {
          "type": "string"
        },
        "txValue": {
          "type": "string"
        },
        "onchainTxHash": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "description": "BUILT, BROADCASTED, CONFIRMED, FAILED"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "orderId",
        "chainId",
        "oneinchPayload",
        "status"
      ]
    },
    "MarketData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MarketData",
      "type": "object",
      "description": "Stores real-time market data for a market.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Market ID, e.g., BTC-USDT"
        },
        "lastPrice": {
          "type": "number"
        },
        "change24h": {
          "type": "number"
        },
        "volume24h": {
          "type": "number"
        },
        "high": {
          "type": "number"
        },
        "low": {
          "type": "number"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "lastPrice"
      ]
    },
    "IdempotencyKey": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "IdempotencyKey",
      "type": "object",
      "description": "Used to prevent duplicate processing of requests.",
      "properties": {
        "id": {
          "type": "string",
          "description": "The idempotency key provided by the client."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "users/{userId}": {
      "schema": {
        "$ref": "#/entities/User"
      },
      "description": "Stores user account information."
    },
    "users/{userId}/balances/{tokenId}": {
      "schema": {
        "$ref": "#/entities/Balance"
      },
      "description": "Subcollection for user balances."
    },
    "orders/{orderId}": {
      "schema": {
        "$ref": "#/entities/Order"
      },
      "description": "Stores all user orders."
    },
    "orders/{orderId}/trades/{tradeId}": {
      "schema": {
        "$ref": "#/entities/Trade"
      },
      "description": "Subcollection for trades executed as part of an order."
    },
    "tokens/{tokenId}": {
      "schema": {
        "$ref": "#/entities/Token"
      },
      "description": "Public collection of all supported tokens."
    },
    "markets/{marketId}": {
      "schema": {
        "$ref": "#/entities/Market"
      },
      "description": "Public collection of all supported markets."
    },
    "market_data/{marketId}": {
      "schema": {
        "$ref": "#/entities/MarketData"
      },
      "description": "Public collection for real-time market statistics."
    },
    "ledger_entries/{entryId}": {
      "schema": {
        "$ref": "#/entities/LedgerEntry"
      },
      "description": "Global collection of all ledger entries for auditing. Rules will restrict access."
    },
    "dex_transactions/{dexTxId}": {
      "schema": {
        "$ref": "#/entities/DexTransaction"
      },
      "description": "Stores the payload and status for on-chain transactions."
    },
    "idempotency/{key}": {
      "schema": {
        "$ref": "#/entities/IdempotencyKey"
      },
      "description": "Collection to ensure idempotent writes for critical operations."
    }
  }
}
